{% extends "base.html" %}
{% load humanize %}
{% block title %}D√©tail de {{ classroom.name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <h2 class="mb-4">
    <i class="fas fa-chalkboard-teacher me-2"></i>
    Classe ¬´ {{ classroom.name }} ¬ª
  </h2>

  <!-- Boutons d‚Äôaction -->
  <div class="mb-3">
    <a href="{% url 'inventory:classroom-list' %}" class="btn btn-secondary">
      ‚Üê Retour √† la liste
    </a>
    {% if user.role == 'admin' %}
      <a href="{% url 'inventory:classroom-edit' classroom.pk %}" class="btn btn-warning">
        ‚úé Modifier
      </a>
      <a href="{% url 'inventory:classroom-delete' classroom.pk %}" class="btn btn-danger">
        üóë Supprimer
      </a>
    {% endif %}
  </div>

  <!-- Statistiques sommaires -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5>Capacit√©</h5>
          <p>{{ classroom.children.count }} / {{ classroom.max_children }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5>Pr√©sences aujourd‚Äôhui</h5>
          <p>{{ todays_presences|length }} / {{ classroom.children.count }}</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center">
        <div class="card-body">
          <h5>Progr√®s r√©cents</h5>
          <p>{{ recent_progress|length }} enregistr√©s</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglets ou sections -->
  <ul class="nav nav-tabs mb-3" id="detailTabs" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-children">
        √âl√®ves ({{ children|length }})
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-presences">
        Pr√©sences
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-progress">
        Progr√®s
      </button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- √âl√®ves -->
    <div class="tab-pane fade show active" id="tab-children">
      <table class="table table-hover">
        <thead class="table-dark">
          <tr><th>√âl√®ve</th><th>Parent</th><th>Niveau Arabe</th><th>Niveau</th></tr>
        </thead>
        <tbody>
          {% for c in children %}
          <tr>
            <td>{{ c.user.get_full_name|default:c.user.username }}</td>
            <td>{{ c.parent.user.get_full_name|default:"‚Äî" }}</td>
            <td>{{ c.arabic_level|default:"‚Äî" }}</td>
            <td>{{ c.learning_level|default:"‚Äî" }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="4" class="text-center">Aucun √©l√®ve.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pr√©sences -->
    <div class="tab-pane fade" id="tab-presences">
      <table class="table table-hover">
        <thead class="table-dark">
          <tr><th>√âl√®ve</th><th>Date</th><th>Pr√©sent</th></tr>
        </thead>
        <tbody>
          {% for p in todays_presences %}
          <tr>
            <td>{{ p.child.user.get_full_name|default:p.child.user.username }}</td>
            <td>{{ p.date|date:"d/m/Y" }}</td>
            <td>
              {% if p.present %}‚úî{% else %}‚úò{% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="3" class="text-center">Aucune pr√©sence aujourd‚Äôhui.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Progr√®s -->
    <div class="tab-pane fade" id="tab-progress">
      <table class="table table-hover">
        <thead class="table-dark">
          <tr>
            <th>√âl√®ve</th><th>Sourate</th><th>Verset</th><th>Date</th><th>Valid√©</th>
          </tr>
        </thead>
        <tbody>
          {% for pr in recent_progress %}
          <tr>
            <td>{{ pr.child.user.get_full_name|default:pr.child.user.username }}</td>
            <td>{{ pr.surah }}</td>
            <td>{{ pr.verse }}</td>
            <td>{{ pr.date_retention|date:"d/m/Y" }}</td>
            <td>{% if pr.validated %}Oui{% else %}Non{% endif %}</td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center">Aucun progr√®s.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
